# 2.28 Sub-parsers

Sub-parsers are pre-processors that run before the main parser. They allow the programmer to implement custom transformations over parts of a template.

Sub-parsers can be implemented as functions, static methods, or instance methods in a class that extends div. For security reasons, sub-parsers must be registered before parsing using `div::setSubParser()`.

**Syntax**

```
{sub-parser-name}
    ... code sent to the sub-parser ...
{/sub-parser-name}
```

**Example**

index.php

```php
<?php

include "div.php";

function literal($code){
    return "{ignore}$code{/ignore}";
}

function body($code, &$items){
    $items['body'] = '<p>'.$code.'</p>';
    return "";
}

class MyPage extends div{
    public function beforeBuild(){
        self::setSubParser('combobox', 'buildCombobox');
    }

    public function buildCombobox($properties){
        $prop = self::jsonDecode('{'.$properties.'}');
        $html = "<select name = \"{$prop->name}\">\n";
        foreach ($prop->options as $option) {
            $html .= "<option value=\"{$option->v}\">{$option->c}</option>\n";
        }
        $html .= "</select>\n";
        return $html;
    }

    public function upperthis($text, &$items){
        $text = trim($text);
        if (self::issetVar($text, $items)) {
            $items[$text] = strtoupper($items[$text]);
        }
    }
}

MyPage::setSubParser('literal');
MyPage::setSubParser('noparse', 'literal');
MyPage::setSubParser('body');

// Similar static registration
// div::setSubParser('upperthis');

echo new MyPage('index.tpl');
```

index.tpl

```
{body}
    Hello world, this is my first sub-parser
{/body}

{combobox}
    name: 'cboCities',
    options: [
        {v: 'NY', c: 'New York'},
        {v: 'PA', c: 'Paris'},
        {v: 'TK', c: 'Tokio'}
    ]
{/combobox}

{upperthis}body{/upperthis}

{$body}

{literal}
  {$body}
{/literal}
```

Output

```
<select name = "cboCities">
  <option value="NY">New York</option>
  <option value="PA">Paris</option>
  <option value="TK">Tokio</option>
</select>

<P>
    HELLO WORLD, THIS IS MY FIRST SUB-PARSER
</P>

{$body}
```

Related topics: [[02.29 Pre-defined sub-parsers]], [[02.30 Sub-parser's events]].
