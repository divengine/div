# 2.27 Macros

Macros execute restricted PHP inside templates. They are intended for small, controlled transformations and should not replace application logic.

**Syntax**

```
<?
// ... PHP code ...
?>
```

**Example**

index.php

```php
<?php

include 'div.php';

class Page extends div{
    public function upper($str){
        return strtoupper($str);
    }
}

echo new Page('index.tpl', [
    'products' => ['Banana', 'Potato']
]);
```

index.tpl

```
{= text: "hello" =}

{$text}

<?
    // upper() is a method of current class
    $text = upper($text);
?>

{$text}

Products:

<?
    $i = 0;
    foreach ($products as $product) {
        $i++;
        echo "$i - $product\n";
    }
?>

There are {$i} products
```

Output

```
hello

HELLO

Products:

1 - Banana
2 - Potato

There are 2 products
```

## 6.27.1 Restrictions

- `$this` and `self` are not allowed.
- Only a restricted set of PHP functions is allowed by default. You can extend this list with `setAllowedFunction`.
- Defining functions or classes is not allowed.
- Including other scripts is not allowed.

## 6.27.2 Capabilities

- Create template variables.
- Modify template variables.
- Echo output (avoid creating infinite loops).
- Use the allowed div helper methods as functions.
- If the current class extends div, you can call its methods directly.
