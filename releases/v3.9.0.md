# Release v3.9.0
Date: 2013-05-18

## Description

- The scalar values as a complex values! What?

  Yes! Now all the scalar values can be used as strings. Then, the strings can be
  used like complex values, that is to say, as group of characters. For example:

  index.tpl
  --------------
  {= name: "Peter" =}

  <!--{ Show the first character }-->
  {$name.0}

 <!--{ Show the second character }-->
  {$name.1}

  {= x: 537 =}

  <!--{ Show the first digit }-->
  {$x.0}

 <!--{ Show the second digit }-->
  {$x.1}

  <!--{ Spacify the name }-->
  [$name]{$value} [/$name]

  <!--{ Multiply the digits of x }-->
  [$x] {$value} * [/$x] = (# [$x] {$value} * [/$x] 1 #)

  Output:
  ----------------
  P

  e

  5

  3

  P e t e r

  5 * 3 * 7 = 105



- Fix some issues
- New method div::isSring as a safe is_string():
  - if is a string return true
  - if is a object with __toString method return true



- bugfix of template variables when it use object's methods
   Now you can call a object's method with some ways:

   Similar to PHP:

   {= result: ->method(param1, param2, param3) =}

   One parameter as JSON data:

   {= result: ->method({param1: value1, param2: value2});

- bugfix of loops, prevent a recursion with var '_item' as object inside the same object:

	Product Object
	(
	    [price] => 0
	    [quantity] => 0
	    [_item] => Product Object
	 *RECURSION*
	)



- The order respect of template variables's manipulation was improved:

	Example:
	-------------
	{= a: 5 =}

	{$a}

	{= a: (# {$a} + 1 #) =}

	{$a}

	{= a: (# {$a} + 1 #) =}

	{$a}

	Output:
	-----------

	5

	6

	7


- The template variables's manipulation was improved:

   Example:
   ---------------

   {= product: {
   		name: "banana"
   		price: 20
   } =}

   Name: {^product.name}
   Price: ${#product.price:2.#}

   {= product.price: (# {$product.price} * 2 #) =}

   Double price: ${#product.price:2.#}

   [[product
   Current price: {$price}
   product]]

   Output:
   ----------------

   Name: banana
   Price: $20.00

   Double price: $40.00

   Current price: 40

- New static methods are added:

	div::issetVar($var, $items)
	div::unsetVar($var, $items)
	div::setVarValue($var, $value, $items)
	div::getVarValue($var, $items)
	div::getVars($items)

	Example:
	---------------
	<?php

	include "div.php";

	$data = array();

	div::setVarValue("product.name", "Banana", $data);
	div::setVarValue("product.price", 10, $data);
	div::setVarValue("product.amount", 0, $data);

	if (div::issetVar("product.name", $data)){
		echo div::getVarValue("product.name", $data);
	}

	div::unsetVar("product.amount", $data);

	if (!div::issetVar("product.amount", $data)){
		echo "Amount not specified";
	}

	print_r(div::getVars($data));

	Output:
	---------------------
	Banana
	Amount not specified
	Array
	(
	    [0] => product
	    [1] => product.name
	    [2] => product.price
	)

- The method setItem and getItem was improved with detection of complex variable's names:

	Example:
	----------------------

	<?php

	include "div.php";

	$tpl = new div("index.tpl", array(
		"product" => array(
			"name" => "Banana",
			"price" => null
		)
	));

	$tpl->setItem("product.price", 10);

	index.tpl
	-------------------
	Name: {$product.name}
	Price: ${#product.price:2.#}

	Output
	------------------
	Name: Banana
	Price: $10.00


- bugfix in the bodies of multi-replacements
- Changed the name of method multiReplace by parseMultiReplace



- Performance: work remembered! Now the engine can remember some
  actions from previous work and increase their speed.
- New feature: the macros.

  A macro is a restricted PHP code inside the templates to facilitate the complex processing
  with the advantages of this language. The security is guaranteed. See the next silly example:

  index.php
  ----------
  <?php

  include 'div.php';

  echo new div('index.tpl', array('title' => 'Hello world'));

  index.tpl
  -------------
  <?
  	echo $title;
  	$title = strtoupper($title);
  ?>

  {$title}

  Output
  -----------
  Hello world

  HELLO WORLD

- New feature: the custom sub-parsers

  A sub-parser is a parser implmemented by the programmer. For example:

  index.php
  --------------
  <?php

  include 'div.php';

  function literal($code){
  	return '{ignore}'.$code.'{/ignore}';
  }

  div::setSubparser('literal');

  echo new div('index.tpl', array('title' => 'Hello world'));

  index.tpl
  ----------------

  {literal}
  <script>

  // bla bla bla {$title}

  </script>
  {/literal}

  {$title}

  Ouput
  ----------------
  <script>

  // bla bla bla {$title}

  </script>

  Hello world




- The interpretation of aggregate functions was improved.
  The next example work now:

	index.tpl
	------------
	{= products: [
		{name: "Banana", price: 10},
		{name: "Potato", price: 20}
	] =}

	{$products.0.price}
	{#products.0.price:2#}

	{$sum:products-price}
	{#sum:products-price:2,#}
	{%sum:products-price} <!--{ digit count }-->

	Output
	-------------
	10
	10.00

	30
	30,00
	2



- The interpretation of date format was improved.

	If you need type the char ":" in the format, and this
	char is the separator between var and format, then type
	a backslash before ":", like as this:

	{/2012-01-01 00:30:00 : Y-m-d h\:i\:s/}

	In the example the value is "2012-01-01 00:30:00 " and
	the format is "Y-m-d h:i:s".



- New static method anyToStr, for convert mixed value to string based on this rule:
	- string is string
	- boolean is "true" or "false"
	- number is "number"
	- object with __toString() is __toString()
	- object without __toString() is array
	- array is count()
- Changed the type of unchangeable methods to "final".



- Enable custom dialect for developers!

   A dialect is defined by the group of constant whose name
   begins with DIV_TAG. This dialect is subject to some simple
   rules that Div forces to complete for preveer inconsistencies and
   infinite loops.

- New static method isValidCurrentDialect, for detect error in the
  definition of current dialect, based on this rule:
   - some tags are required, like as, prefixes, suffixes, beginnings and ends.
   - some tags must be unique, like as, modifiers, else, break, empty, ...



- Created a tool to build dialects.
- Release the 3.9 version



## Commits
- No commits found.
