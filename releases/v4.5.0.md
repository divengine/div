# Release v4.5.0

Date: 2014-12-01

## Description

December 1,  2014

- some bug fixes
- Release 4.5 version

November 24,  2014

- improve `div::isValidPHPCode()`

October 7,  2014

- improve performance changing $vars with `__temp['vars']` var in `parseMacros();` because because `get_defined_vars` return also `vars`
- prevent infinite loops in `div::cop();`

October 6,  2014

- new setup var: `div.clear_locations` (= true by default). This means that the locations will be clear or not at the end (parse_level = 0). Then, the component are more flexible with **pre-processed templates**:

comp.tpl

```html
(( before )) <input type="{$type}" name="{$name}"> (( after ))
```

index.tpl

```html
{%% comp: {
type: "text",
name: "first_name",
div: {
clear_locations: false
}
} %%}

<!--{ If div.clear_locations is true (by default), the next code don't work }-->

{{before <label>First Name</label> before}}
{{after <input type="submit"> after}}
```

September 26,  2014

- bugfix `parseData()` vs `parseMatch()` logical order

September 23,  2014

- bug fix in `parsePreprocessed()` when $pdata is null
- bug fix with number formats inside loops

September 21,  2014

- new feature: advanced options/params for includes

index.tpl

```div
{% subtpl: {
from: "<!--{ begin }-->",
to: "<!--{ end }-->",
offset: 2,
limit: 1
} %}
```

subtpl.tpl

```div
Any text...

<!--{ begin }-->Some text 1<!--{ end }-->

Any text...

<!--{ begin }-->Some text 2<!--{ end }-->

Any text
```

- bugfix: Preparing allowed methods before execute the macros

September 20,  2014

- bugfix: Parsing macros inside preprocessed templates. New argument $min_level for parse() method.
- Add new allowed functions in macros, formulas and expressions: `array_keys` `get_object_vars` `is_object`
- new static method `div::div():`

index.php

```php
<?php
echo div::div('index.tpl', array("item1" => "value1"));
```

- Allow T_BREAK token in macros for foreach and other loops. Then, the follow macro is an error:

index.tpl

```php
<? break; ?>
```

Output

```shell
Fatal error: Cannot break/continue 1 level in div.php: eval()'d code on line 1
```

September 17,  2014

- bugfix/improve - Parsing orphan's parts while checksum not change. Do it because the orphans's parts stop the parser and the results are ugly.

September 16,  2014

- big fix: Set the priority to inline data in pre-processed templates above global design vars

September 11,  2014

- bigfix: Save sections of loops and capsules when makeItAgain(); (Div doesn't know the future)

September 9,  2014

- bugfix: Adding items to array in templates

```div
{= somearray[]: "new item" =}

```

- bugfix: Don't set item var as design var in div::parseData();

September 8,  2014

- bugfix: Parse pre-processed templates with all items/vars (Div doesn't know the future)

August 28,  2014

- New feature for preprocessed templates: specific data

Syntax:

```div
{%% tpl_file: data %%}

```

data is: json, name of var or filename with json

Example:

Now is more simple for build the components:

index.tpl

```div
{%% form: {
        action: "login.php",
        method: "post.php",
        fields: [
            {
                type: "text",
                name: "user",
                label: "User"
            },{
                type: "password",
                name: "pass",
                label: "Password"
            }
        ],
        submit: {
            value: "login",
            name: "btnLogin"
        }
} %%}

```

form.tpl

```html
<form action="{$action}" method="{$method}">
    [$fields]
        {$label}:<br/>
        <input type="{$type}" name="{$name}"><br/>
    [/$fields]
    <input type="submit" name="{$name}" value="{$value}">
</form>
    

```

August 17,  2014

- Security fix: prevent obtrusive code in method calls. Now next code dont work:

```div
{= content: ->getPage(file_put_contents('some.txt','some text')) =}

```

August 5,  2014

- Fix the memory in the loops

August 4,  2014

- Fix macros parsing when a previous template var never match

August 2,  2014

- Allow is_array PHP function in macros
- New method for add literal vars in PHP: div::addLiteral();

June 30,  2014

- Some bugfixs
- Add new important security feature: setup literals items/vars, for prevent injections!

Example:

index.tpl

```div
{= div.literals: ["text1", "text2"] =}    <!--{ in PHP div::addLiteral(array("text1","text2")); }-->

{$text1}

{$text2}

{$text3}

```

index.php

echo new div('index.tpl', array( 'text1' => '{/ignore}[:1,5:] {$value} [/]{ignore}', // I am being about deceiving the security 'text2' => '[:1,100;] text to repeat [/]', 'text3' => '[:1,3;] some [/]'

```div
));

```

output

```div
[:1,5;] {$value} [/]
[:1,100;] text to repeat [/]
```

some some some

February 05,  2014

- Memory fixed!

December 25,  2013

- bugfix: div::fileExists and wrong include paths calculation

December 5,  2013

- Improvement of global design vars in loops and capsules

December 4,  2013

- bugfix: div::getFileContents()

August 30, 2013

- An important bug was fixed: the memory in the loops:

In div 4.4 dont't work:

index.php

```php
<?php

include "div.php";
echo new div("test.tpl", array("cities" => array("Havana", "Tokyo")));

```

index.tpl

```div
{= foo: [
    { title: "Cities",
      content: '{% cities.tpl %}'
    }
] =}

{% layout.tpl %}

```

layout.tpl

```html
?$foo
    [$foo]
        <h1>{$title}</h1>
        {$content}<br/>
    [/$foo]        
$foo?

```

cities.tpl

```div
?$cities
    [$cities]
        {$value}
    [/$cities]
@else@
```

No cities

```div
$cities?

```

Output (wrong!)

```html
<h1>Cities</h1>
```

No cities<br/>

Output (great in 4.5)

```html
<h1>Cities</h1>
```

Havana Tokio<br/>

July 29, 2013

- Decrease of priority in parser's specialchars

## Commits

- No commits found.
