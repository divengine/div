# Release v5.1.0
Date: 2019-07-22

## Description
- Some bugfixs
- New variable for inline data of preprocessed templates:  `div.standalone`, by default is FALSE.
  This means that the "foo" variable will not be passed to the template pre-processor. That is, the variables in the parent template will be ignored and only the data specified in the line will be used.

```
{= foo: value =}
{%% block.tpl: {
	div: {
		standalone: true
	}
} %%}
```

  This better facilitates the recursive inclusion of  templates, useful in generation of source code and  other hierarchies like XML, HTML, JSON, etc.

- Do not include anything within the conditional blocks if the conditions have not been resolved. This check prevent infinite loops.

```php
   ?$block
   {%% block: {...} %%} <-- wait for block question results
   $block?
```

- Priority change for items over filesystem when include o preprocess templates.  To force load data from external file, please type the path or full path (ex: block.json)
```
{= block: {
    var1: "value1"
    var2: "value2"
} =}
```

  Take the block value
  `{%% tpl: block %%}`

  Take json from external file
  `{%% tpl: block.json %%}`

---
- Improve the translator. Now you can translate from and to other dialects.

```php
$tpl = new div("index.tpl", []);
```

Translate from other dialect to current dialect:

```php
$tpl->translateFrom($dialectFrom);
```

 Translate from current dialect to other dialect:

```php
$tpl->translateTo($dialectFrom);
```

Translate from any dialect to any dialect:

```php
$tpl->translate($dialectFrom, $dialectTo, $src, $items);
```

Maybe you need prepare the current dialect first:

```php
prop = $tpl->getTemplateProperties();
$tpl->__src = $tpl->prepareDialect(null, $prop);
```
---
- Fix dynamic include's paths inside loops
```
[$blocks]
	{% blocks/block-{$id}.tpl %}
[/$blocks]
```
---
- Fix and improve getAuxiliaryEngine
---
- Fix a bug with `getAuxiliaryEngine` (clone vs assignment)
- Add some new system vars
    - `div.class_name`: the name of current invoked class ('div' or child of 'div')
    - `div.super_class_name`: the name of super parent of current invoked class name (normally is 'div')
- Code review
---
- Change scope of `->loadTemplateProperties()` to public
- Other minor fixes
- Automatic update of template source code after `prepareDialect()` ...
- ... && new param for `->prepareDialect()` for disable automatic update
---
- Re-thinking the change in **June 10, 2013** about invalid JSON in assignments.  Is important the dynamic path of JSON files:

```
{= i18n: i18n/{$lang}.json =}
```

`"i18n/{$lang}.json"` without quotes is invalid JSON

Then, don't use quotes:
```
{= i18n: "i18n/{$lang}.json" =}
```

- Important improvement for loading JSON data from relative path in template variable's assignment:

```
         relative  -->
                  |
                  v
    /app/site/view/i18n/en/messages.json
                        ^
                        |
                 replacement result
```

/app/site/view/page.tpl

```
{= lang: "en" =}
{= i18n: i18n/{$lang}/messages.json =}

{$i18n.message1}
```

/app/site/view/i18n/en/messages.json
```
{
	message1: "Hello"
}
```

Output:
```
Hello
```
---
- `bugfix` on constructor, when div var is an object and not an array
- Add file_exists as allowed function
- Add in_array as allowed function
---
- Optimize the code: change "is_null" as "=== null", because is_null is 250ns slower (in favor of PHP 5)

In PHP 7 (phpng), is_null is actually marginally faster than `===`, although the performance difference between the two is far smaller.

```
PHP 5.5.9
is_null - float(2.2381200790405)
===     - float(1.0024659633636)
=== faster by ~100ns per call

PHP 7.0.0-dev (built: May 19 2015 10:16:06)
is_null - float(1.4121870994568)
===     - float(1.4577329158783)
is_null faster by ~5ns per call
```
---
- `bugfix`: better resolution of tags with empty suffix. In this example "list.filter" is a substring of "list.filter.category", and then exists resulting unexpected code if $list.filter is false

TPL
```
?$list.filter
  AAA
	?$list.filter.category
		BBB
	$list.filter.category?
  CCC
$list.filter?
```

OUTPUT
```
?$list.filter
  AAA
```

The fix was for other similar situations in div::getBlockRanges().
The stop chars are the same in favor of text plain and XML family:

```php
$stop_chars = ["<",	">", ' ', "\n", "\r", "\t"];
```
---
- important change!: Now NULLs vars exists and are replaced with empty strings

PHP
```php
echo new div('Var is: {$var}', ['var' => null]);
```

OUTPUT before this change:
```
Var is: {$var}
```

OUTPUT after this change:
```
Var is:
```

- `important change!`: Fix scope of pre-processed templates inside loops

Do not pre-process anything within the loops blocks if the loops have not been resolved
The following code did not work as expected, because the pre-process was executed before doing the loop. So the `$col` variable did not exist and logic of the template will be broken.

```
[$cols] col =>
	{%% element: {
		tag: "td",
		attrs: $col.attrs,
		inner: $col.content
	} %%}
[/$cols]
```
---
- new feature for custom engine:

MyComponent.php
```php
MyComponent extends div {
 ....
}
```

index.tpl:
```
{%% component: {
	div: {
		engine: "MyComponent"
	},
	someProperty: "bla"
} %%}
```
---
- Divengine namespace!
- `bugfix`: Fix scope of standalone pre-precessed templates.  This fix prevent infinite loops and is util for recursive pre-process in a component based design.

index.tpl
```
{= foo: "bar" =}
{%% component: {
	div: {standalone: true}, // ignore parent scope
	zoo: "monkey"
} %%}
```

component.tpl
```
{$zoo}
{$foo} <!--{ not exists in this scope }-->
```
---
- `bugfix` in div::scanMatch
---
- `release` version 5.1.0
- `improvement`: Better resolution of default template for child classes of div, using Reflection!

**/some/folder/in/the/end/of/the/world/Page.tpl**
```
Hello people
```

**/some/folder/in/the/end/of/the/world/Page.php**
```php
<?php4

use divengine\div;

class Page extends div {

}
```

**/index.php**
```php
<?php

include '/some/folder/in/the/end/of/the/world/Page.php';

echo new Page();
```

**Output**
```
Hello people
```
---

## Commits
- No commits found.
